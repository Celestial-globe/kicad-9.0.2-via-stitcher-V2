# KiCad VIAステッチングプラグイン V2.3.0

KiCadのPCBエディタ（Pcbnew）で選択された銅エリアにVIAを自動配置するプラグインです。熱伝導や電流伝導を改善するためのVIAステッチングを効率的に行うことができます。

![VIAステッチャーの使用例](images/via_stitcher_v2.3.0.png)

## 📋 機能

* **自動VIA配置**: 選択されたゾーン（銅エリア）内にVIAを自動配置
* **複数の配置パターン**: 格子状、境界配置、スパイラル配置に対応
* **高速処理**: 空間インデックス化により大量のVIA配置を高速化
* **プログレスバー**: 長時間の処理にもプログレス表示でユーザビリティ向上
* **ランダム配置**: 規則的でない配置も可能
* **VIAクリア機能**: プラグインで配置したVIAのみの削除も可能
* **設定保存**: パラメータ設定を保存・復元
* **リアルタイムプレビュー**: 配置パターンをダイアログ内でプレビュー表示

### 衝突回避機能

* **パッド回避**: フットプリントのパッドとの衝突を自動回避
* **トラック回避**: 異なるネットの配線（トラック）との衝突を自動回避
* **禁止領域回避**: Keepout Zoneへの配置を自動回避
* **基板外形考慮**: 基板外へのはみ出しを防止

## 🎯 対応環境

* **KiCad**: 9.0.2 で動作確認済み（他のバージョンでも動作する可能性があります）
* **OS**: Windows, Linux, macOS
* **Python**: KiCad付属のPythonランタイム

## ⚡ インストール方法

1. `via_stitcher_v2.py` をダウンロード
2. KiCadのプラグインフォルダに配置：
   * **Windows**: `%APPDATA%\kicad\<version>\scripting\plugins\`
   * **Linux**: `~/.local/share/kicad/<version>/scripting/plugins/`
   * **macOS**: `~/Library/Application Support/kicad/<version>/scripting/plugins/`
3. KiCadを再起動
4. Pcbnewのツールメニューから「External Plugins」→「VIAステッチングV2」を選択

## 🚀 使用方法

1. Pcbnewでプロジェクトを開く
2. VIAを配置したいゾーン（銅エリア）を選択
3. プラグインメニューから「VIAステッチングV2」を実行
4. ダイアログでパラメータを設定：
   * VIAサイズ・ドリルサイズ
   * 配置間隔・オフセット
   * エッジクリアランス
   * 配置パターン選択
   * ネット選択
   * クリアランス設定（パッド/トラック/VIA間）
   * 衝突回避オプション
5. 「OK」ボタンでVIA配置実行

### 配置パターン

* **格子状配置**: 規則的な格子パターンでVIAを配置
* **境界配置**: ゾーンの境界線に沿ってVIAを配置(一部配置が乱れます)
* **スパイラル配置**: 中心から外側に向けてスパイラル状に配置

### クリアランス設定

| 設定項目 | デフォルト値 | 説明 |
|---------|------------|------|
| エッジクリアランス | 0.5mm | ゾーン境界からの距離 |
| パッドクリアランス | 0.2mm | パッドからの距離 |
| トラッククリアランス | 0.2mm | 配線からの距離 |
| VIA間クリアランス | 0.25mm | VIA同士の距離 |

### 衝突回避オプション

各チェックは個別にON/OFFできます：
* **パッドとの衝突を回避**: フットプリントのパッド上への配置を防止
* **トラック（配線）との衝突を回避**: 異なるネットのトラック上への配置を防止（同じネットは許可）
* **禁止領域（Keepout）を回避**: VIA配置禁止のKeepout Zone内への配置を防止
* **基板外形を考慮**: 基板外へのはみ出しを防止

## ⚠️ 制約事項・注意点

* **CC0ライセンス**: パブリックドメインで提供されています
* **個人開発**: サポートは期待できません
* **四角形以外の領域**: 複雑な形状のゾーンでは、はみ出して描画される場合があります
* **バックアップ推奨**: 使用前に必ずプロジェクトのバックアップを取ってください
* **大量VIA**: 大量のVIA配置時はKiCadが重くなる場合があります
* **DRCチェック**: 配置後は必ずDRCチェックを実行してください

## 🔧 既知の問題

* 複雑な形状のゾーンでの配置精度
* 非常に密な配置でのメモリ使用量増加
* 一部のKiCadバージョンでのAPI互換性問題
* ゾーン重複エッジ部にVIAが被る問題

## 💡 トラブルシューティング

### プラグインが表示されない

* KiCadを再起動してください
* プラグインファイルの配置場所を確認してください

### VIAが配置されない

* ゾーンが正しく選択されているか確認してください
* 配置パラメータ（間隔・クリアランス）を調整してください
* ネットが正しく選択されているか確認してください
* 衝突回避設定により除外されている可能性があります（完了ダイアログでスキップ理由を確認）

### 動作が重い

* VIA配置数を減らしてください（間隔を広くする）
* プログレスダイアログでキャンセルできます

## 🔄 更新履歴
V2.3.0 変更点:

【新機能】
- 他のネットのゾーンとの重なり部分へのVIA配置を回避
- 例: GNDゾーン上にVCCゾーンが重なっている場合、重なり部分を避けてVIAを配置

【技術的変更】
- BoardGeometryCheckerにtarget_net_codeパラメータを追加
- _get_other_net_zones()メソッドを追加
- is_point_in_other_zone()メソッドを追加
- can_place_via()にcheck_other_zonesパラメータを追加

【UI変更】
- 「他のネットのゾーンとの重なりを回避」チェックボックスを追加
- スキップ理由の統計に「他ネットゾーン内」を追加

【デフォルト設定】
- check_other_zones: True（デフォルトで有効）

### V2.2.0

* トラック（配線）との衝突回避機能を追加
* VIA間クリアランスの数値入力対応
* トラッククリアランスの数値入力対応
* クリアランス設定UIを整理

### V2.1.0

* パッドとの衝突回避機能を追加
* 禁止領域（Keepout Zone）回避機能を追加
* 基板外形考慮機能を追加
* ゾーンのポリゴン形状を使用した配置判定

### V2.0.7

* 初版リリース
* 空間インデックス化による高速処理
* プログレスバー対応

## 📄 ライセンス

CC0 1.0 Universal (CC0 1.0) Public Domain Dedication

このプラグインは無料で提供されており、**寄付は一切不要**です。
自由にご利用、改変、再配布してください。

## ⚖️ 免責事項

このプラグインの使用により発生したいかなる損害についても、開発者は責任を負いません。
使用は自己責任でお願いします。必ず使用前にプロジェクトのバックアップを取ってください。

---

*KiCad VIAステッチングプラグイン - より効率的なPCB設計のために*
